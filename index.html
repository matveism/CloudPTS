<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizBux - DoorDash-Style System</title>
    <!-- React & ReactDOM CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --bg-sidebar: #111827;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --primary: #3b82f6;
            --primary-hover: #2563eb;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #0ea5e9;
            --border: #334155;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        #root {
            min-height: 100vh;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 260px;
            background-color: var(--bg-sidebar);
            padding: 24px 0;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border);
        }

        .sidebar-logo {
            padding: 0 24px 24px;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--primary);
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 24px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s ease;
            border-left: 4px solid transparent;
        }

        .nav-item:hover, .nav-item.active {
            background-color: rgba(30, 41, 59, 0.7);
            color: var(--text-primary);
            border-left-color: var(--primary);
        }

        .nav-item i {
            width: 20px;
            text-align: center;
        }

        .main-content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background-color: var(--bg-card);
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: transform 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
        }

        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 16px;
        }

        .stat-icon.balance { background-color: rgba(16, 185, 129, 0.15); color: var(--success); }
        .stat-icon.ar { background-color: rgba(14, 165, 233, 0.15); color: var(--info); }
        .stat-icon.points { background-color: rgba(59, 130, 246, 0.15); color: var(--primary); }
        .stat-icon.status { background-color: rgba(168, 85, 247, 0.15); color: #a855f7; }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .card {
            background-color: var(--bg-card);
            border-radius: 12px;
            padding: 28px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            margin-bottom: 28px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-block {
            width: 100%;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-control {
            width: 100%;
            padding: 14px;
            background-color: rgba(30, 41, 59, 0.7);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        textarea.form-control {
            min-height: 140px;
            resize: vertical;
        }

        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        .auth-box {
            background-color: var(--bg-card);
            border-radius: 16px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 440px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .auth-header {
            padding: 40px 40px 20px;
            text-align: center;
        }

        .auth-logo {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .auth-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .auth-subtitle {
            color: var(--text-muted);
            margin-bottom: 20px;
        }

        .auth-body {
            padding: 0 40px 40px;
        }

        .auth-footer {
            padding: 24px 40px;
            background-color: rgba(30, 41, 59, 0.5);
            text-align: center;
            color: var(--text-muted);
            border-top: 1px solid var(--border);
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .tab {
            padding: 14px 24px;
            background: none;
            border: none;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            position: relative;
        }

        .tab.active {
            color: var(--primary);
            font-weight: 600;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .table-responsive {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background-color: rgba(30, 41, 59, 0.8);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border);
        }

        .table td {
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }

        .table tbody tr:hover {
            background-color: rgba(30, 41, 59, 0.5);
        }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-success { background-color: rgba(16, 185, 129, 0.15); color: var(--success); }
        .badge-warning { background-color: rgba(245, 158, 11, 0.15); color: var(--warning); }
        .badge-danger { background-color: rgba(239, 68, 68, 0.15); color: var(--danger); }
        .badge-info { background-color: rgba(14, 165, 233, 0.15); color: var(--info); }

        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(59, 130, 246, 0.2);
            border-left-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 16px;
            color: var(--border);
        }

        .toast-container {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toast {
            background-color: var(--bg-card);
            border-radius: 8px;
            padding: 18px;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
            min-width: 320px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            border: 1px solid var(--border);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            border-left-color: var(--success);
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        .toast-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .toast-icon {
            font-size: 1.2rem;
        }

        .toast-title {
            font-weight: 600;
            font-size: 1rem;
        }

        .toast-message {
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        .ar-progress-container {
            margin: 30px 0;
        }

        .ar-progress-bar {
            height: 28px;
            background-color: rgba(30, 41, 59, 0.7);
            border-radius: 14px;
            overflow: hidden;
            margin-bottom: 12px;
            position: relative;
            border: 1px solid var(--border);
        }

        .ar-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--danger), var(--warning), var(--success));
            border-radius: 14px;
            transition: width 0.8s ease;
        }

        .ar-current {
            position: absolute;
            top: -40px;
            transform: translateX(-50%);
            background-color: var(--bg-card);
            color: var(--text-primary);
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
        }

        @media (max-width: 1024px) {
            .sidebar {
                width: 80px;
            }
            .sidebar-logo span, .nav-item span {
                display: none;
            }
            .nav-item {
                justify-content: center;
                padding: 16px;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                flex-direction: row;
                padding: 16px;
                justify-content: space-around;
            }
            .sidebar-logo {
                display: none;
            }
            .main-content {
                padding: 20px;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Your Google Apps Script URL - Pre-configured
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby--a2BFNnfOkYDi-faY8DIk5S3ohTRbBhCD3riZ_7L-pFmEcQ-oOPEvtgyjNXoWPtfQg/exec';

        // Toast Component
        function Toast({ type, title, message, onClose }) {
            React.useEffect(() => {
                const timer = setTimeout(() => {
                    onClose();
                }, 5000);
                return () => clearTimeout(timer);
            }, [onClose]);

            return (
                <div className={`toast ${type} show`}>
                    <div className="toast-header">
                        <i className={`toast-icon fas ${
                            type === 'success' ? 'fa-check-circle' : 
                            type === 'error' ? 'fa-exclamation-circle' : 
                            'fa-info-circle'
                        }`}></i>
                        <div className="toast-title">{title}</div>
                    </div>
                    <div className="toast-message">{message}</div>
                </div>
            );
        }

        // Toast Container
        function ToastContainer({ toasts, removeToast }) {
            return (
                <div className="toast-container">
                    {toasts.map(toast => (
                        <Toast
                            key={toast.id}
                            type={toast.type}
                            title={toast.title}
                            message={toast.message}
                            onClose={() => removeToast(toast.id)}
                        />
                    ))}
                </div>
            );
        }

        // API Call Helper
        async function callApi(action, params = {}) {
            const formData = new URLSearchParams();
            formData.append('action', action);
            
            Object.keys(params).forEach(key => {
                if (params[key] !== undefined && params[key] !== null) {
                    formData.append(key, params[key]);
                }
            });

            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: formData.toString()
                });

                if (!response.ok) {
                    throw new Error(`HTTP error ${response.status}`);
                }

                const data = await response.json();
                return data;
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        // Main App Component
        function App() {
            const [currentUser, setCurrentUser] = React.useState(null);
            const [currentPage, setCurrentPage] = React.useState('dashboard');
            const [toasts, setToasts] = React.useState([]);
            const [isLoading, setIsLoading] = React.useState(false);

            // Check for existing session on load
            React.useEffect(() => {
                const savedUser = localStorage.getItem('quizbux_user');
                if (savedUser) {
                    const userData = JSON.parse(savedUser);
                    restoreSession(userData.username);
                }
            }, []);

            const restoreSession = async (username) => {
                setIsLoading(true);
                try {
                    const response = await callApi('getUserData', { username });
                    if (response.status === 'success') {
                        setCurrentUser(response.user);
                        showToast('success', 'Welcome Back!', `Welcome back, ${response.user.username}!`);
                    } else {
                        localStorage.removeItem('quizbux_user');
                    }
                } catch (error) {
                    console.error('Session restore failed:', error);
                } finally {
                    setIsLoading(false);
                }
            };

            const showToast = (type, title, message) => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, type, title, message }]);
            };

            const removeToast = (id) => {
                setToasts(prev => prev.filter(toast => toast.id !== id));
            };

            const handleLogin = async (username, password) => {
                setIsLoading(true);
                try {
                    const response = await callApi('login', { username, password });
                    if (response.status === 'success') {
                        setCurrentUser(response.user);
                        localStorage.setItem('quizbux_user', JSON.stringify({
                            username: response.user.username,
                            lastLogin: new Date().toISOString()
                        }));
                        showToast('success', 'Login Successful', `Welcome to QuizBux, ${response.user.username}!`);
                    } else {
                        showToast('error', 'Login Failed', response.message);
                    }
                } catch (error) {
                    showToast('error', 'Login Error', 'Failed to connect to server');
                } finally {
                    setIsLoading(false);
                }
            };

            const handleRegister = async (username, password, referrer) => {
                setIsLoading(true);
                try {
                    const response = await callApi('register', { username, password, referrer });
                    if (response.status === 'success') {
                        setCurrentUser(response.user);
                        localStorage.setItem('quizbux_user', JSON.stringify({
                            username: response.user.username,
                            lastLogin: new Date().toISOString()
                        }));
                        showToast('success', 'Registration Successful', 'Your account has been created!');
                    } else {
                        showToast('error', 'Registration Failed', response.message);
                    }
                } catch (error) {
                    showToast('error', 'Registration Error', 'Failed to connect to server');
                } finally {
                    setIsLoading(false);
                }
            };

            const handleLogout = () => {
                setCurrentUser(null);
                localStorage.removeItem('quizbux_user');
                showToast('info', 'Logged Out', 'You have been logged out successfully');
            };

            // Render loading screen
            if (isLoading) {
                return (
                    <div className="loading">
                        <div className="spinner"></div>
                        <p>Loading...</p>
                    </div>
                );
            }

            // Render auth screen if no user
            if (!currentUser) {
                return (
                    <>
                        <AuthScreen onLogin={handleLogin} onRegister={handleRegister} />
                        <ToastContainer toasts={toasts} removeToast={removeToast} />
                    </>
                );
            }

            // Render main app
            return (
                <>
                    <div className="app-container">
                        <Sidebar 
                            currentPage={currentPage} 
                            onPageChange={setCurrentPage}
                            user={currentUser}
                            onLogout={handleLogout}
                        />
                        <MainContent 
                            currentPage={currentPage}
                            user={currentUser}
                            showToast={showToast}
                            setCurrentUser={setCurrentUser}
                        />
                    </div>
                    <ToastContainer toasts={toasts} removeToast={removeToast} />
                </>
            );
        }

        // Auth Screen Component
        function AuthScreen({ onLogin, onRegister }) {
            const [activeTab, setActiveTab] = React.useState('login');
            const [loginData, setLoginData] = React.useState({ username: '', password: '' });
            const [registerData, setRegisterData] = React.useState({ 
                username: '', 
                password: '', 
                referrer: '' 
            });

            const handleLoginSubmit = (e) => {
                e.preventDefault();
                onLogin(loginData.username, loginData.password);
            };

            const handleRegisterSubmit = (e) => {
                e.preventDefault();
                onRegister(registerData.username, registerData.password, registerData.referrer);
            };

            return (
                <div className="auth-container">
                    <div className="auth-box">
                        <div className="auth-header">
                            <div className="auth-logo">
                                <i className="fas fa-tasks"></i>
                                <span>QuizBux</span>
                            </div>
                            <h2 className="auth-title">Welcome to QuizBux</h2>
                            <p className="auth-subtitle">Professional DoorDash-Style Review System</p>
                        </div>
                        <div className="auth-body">
                            <div className="tabs">
                                <button 
                                    className={`tab ${activeTab === 'login' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('login')}
                                >
                                    Login
                                </button>
                                <button 
                                    className={`tab ${activeTab === 'register' ? 'active' : ''}`}
                                    onClick={() => setActiveTab('register')}
                                >
                                    Register
                                </button>
                            </div>

                            {activeTab === 'login' ? (
                                <form id="login-form" onSubmit={handleLoginSubmit}>
                                    <div className="form-group">
                                        <label className="form-label">Username</label>
                                        <input 
                                            type="text" 
                                            className="form-control" 
                                            value={loginData.username}
                                            onChange={(e) => setLoginData({...loginData, username: e.target.value})}
                                            required 
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Password</label>
                                        <input 
                                            type="password" 
                                            className="form-control" 
                                            value={loginData.password}
                                            onChange={(e) => setLoginData({...loginData, password: e.target.value})}
                                            required 
                                        />
                                    </div>
                                    <button type="submit" className="btn btn-primary btn-block">
                                        <i className="fas fa-sign-in-alt"></i> Login
                                    </button>
                                </form>
                            ) : (
                                <form id="register-form" onSubmit={handleRegisterSubmit}>
                                    <div className="form-group">
                                        <label className="form-label">Username</label>
                                        <input 
                                            type="text" 
                                            className="form-control" 
                                            value={registerData.username}
                                            onChange={(e) => setRegisterData({...registerData, username: e.target.value})}
                                            required 
                                        />
                                        <small style={{color: 'var(--text-muted)', display: 'block', marginTop: '4px'}}>
                                            3-20 characters (letters, numbers, underscore only)
                                        </small>
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Password</label>
                                        <input 
                                            type="password" 
                                            className="form-control" 
                                            value={registerData.password}
                                            onChange={(e) => setRegisterData({...registerData, password: e.target.value})}
                                            required 
                                        />
                                        <small style={{color: 'var(--text-muted)', display: 'block', marginTop: '4px'}}>
                                            At least 6 characters
                                        </small>
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">Referrer (Optional)</label>
                                        <input 
                                            type="text" 
                                            className="form-control" 
                                            value={registerData.referrer}
                                            onChange={(e) => setRegisterData({...registerData, referrer: e.target.value})}
                                        />
                                    </div>
                                    <button type="submit" className="btn btn-success btn-block">
                                        <i className="fas fa-user-plus"></i> Create Account
                                    </button>
                                </form>
                            )}
                        </div>
                        <div className="auth-footer">
                            <p>AR System: Rejection = -2% | Approval = +0.66% | 3 approvals recover 1 rejection</p>
                        </div>
                    </div>
                </div>
            );
        }

        // Sidebar Component
        function Sidebar({ currentPage, onPageChange, user, onLogout }) {
            const navItems = [
                { id: 'dashboard', label: 'Dashboard', icon: 'fas fa-home' },
                { id: 'submit-work', label: 'Submit Quiz', icon: 'fas fa-plus-circle' },
                { id: 'my-submissions', label: 'My Submissions', icon: 'fas fa-history' },
                { id: 'ar-tracking', label: 'AR Tracking', icon: 'fas fa-chart-line' },
                { id: 'chat', label: 'Live Chat', icon: 'fas fa-comments' },
                { id: 'bonus', label: 'Bonus Codes', icon: 'fas fa-gift' },
                { id: 'cashout', label: 'Cash Out', icon: 'fas fa-wallet' }
            ];

            // Add admin nav if user is admin
            if (user && user.username.toLowerCase() === 'admin') {
                navItems.push({ id: 'admin', label: 'Admin Panel', icon: 'fas fa-user-shield' });
            }

            return (
                <div className="sidebar">
                    <div className="sidebar-logo">
                        <i className="fas fa-tasks"></i>
                        <span>QuizBux</span>
                    </div>
                    {navItems.map(item => (
                        <a 
                            key={item.id}
                            href="#" 
                            className={`nav-item ${currentPage === item.id ? 'active' : ''}`}
                            onClick={(e) => {
                                e.preventDefault();
                                onPageChange(item.id);
                            }}
                        >
                            <i className={item.icon}></i>
                            <span>{item.label}</span>
                        </a>
                    ))}
                    <div style={{ marginTop: 'auto', padding: '24px' }}>
                        <div style={{ 
                            display: 'flex', 
                            alignItems: 'center', 
                            gap: '12px',
                            marginBottom: '16px',
                            paddingBottom: '16px',
                            borderBottom: '1px solid var(--border)'
                        }}>
                            <div style={{
                                width: '40px',
                                height: '40px',
                                borderRadius: '50%',
                                background: 'var(--primary)',
                                display: 'flex',
                                alignItems: 'center',
                                justifyContent: 'center',
                                fontWeight: '600'
                            }}>
                                {user.username.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div style={{ fontWeight: '600' }}>{user.username}</div>
                                <div style={{ fontSize: '0.85rem', color: 'var(--text-muted)' }}>
                                    {user.userStatus} â€¢ AR: {user.ar.toFixed(2)}%
                                </div>
                            </div>
                        </div>
                        <button 
                            className="btn btn-danger btn-block" 
                            onClick={onLogout}
                            style={{ padding: '10px' }}
                        >
                            <i className="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            );
        }

        // Main Content Component
        function MainContent({ currentPage, user, showToast, setCurrentUser }) {
            const [submissions, setSubmissions] = React.useState([]);
            const [arHistory, setArHistory] = React.useState([]);
            const [chatMessages, setChatMessages] = React.useState([]);
            const [isLoading, setIsLoading] = React.useState(false);

            React.useEffect(() => {
                loadPageData();
            }, [currentPage]);

            const loadPageData = async () => {
                if (!user) return;

                setIsLoading(true);
                try {
                    switch(currentPage) {
                        case 'my-submissions':
                            const userData = await callApi('getUserData', { username: user.username });
                            if (userData.status === 'success') {
                                setSubmissions(userData.submissions || []);
                            }
                            break;
                        case 'ar-tracking':
                            const arResponse = await callApi('getARHistory', { username: user.username });
                            if (arResponse.status === 'success') {
                                setArHistory(arResponse.history || []);
                            }
                            break;
                        case 'chat':
                            const chatResponse = await callApi('getChatMessages', { limit: 50, offset: 0 });
                            if (chatResponse.status === 'success') {
                                setChatMessages(chatResponse.messages || []);
                            }
                            break;
                    }
                } catch (error) {
                    console.error('Error loading page data:', error);
                } finally {
                    setIsLoading(false);
                }
            };

            const handleSubmitWork = async (submissionText) => {
                setIsLoading(true);
                try {
                    const response = await callApi('submitWork', {
                        username: user.username,
                        submission: submissionText
                    });

                    if (response.status === 'success') {
                        showToast('success', 'Quiz Submitted!', 'Your quiz has been submitted and is waiting for admin approval.');
                        
                        // Update user data
                        if (response.user) {
                            setCurrentUser(prev => ({
                                ...prev,
                                totalSubmissions: response.user.totalSubmissions,
                                pendingSubmissions: response.user.pendingSubmissions
                            }));
                        }
                        
                        // Reload submissions if on that page
                        if (currentPage === 'my-submissions') {
                            loadPageData();
                        }
                        
                        return true;
                    } else {
                        showToast('error', 'Submission Failed', response.message);
                        return false;
                    }
                } catch (error) {
                    showToast('error', 'Submission Error', 'Failed to submit quiz');
                    return false;
                } finally {
                    setIsLoading(false);
                }
            };

            const handleClaimBonus = async (code) => {
                setIsLoading(true);
                try {
                    const response = await callApi('claimBonus', {
                        username: user.username,
                        code: code
                    });

                    if (response.status === 'success') {
                        showToast('success', 'Bonus Claimed!', response.message);
                        
                        if (response.user) {
                            setCurrentUser(prev => ({
                                ...prev,
                                balance: response.user.balance,
                                userStatus: response.user.userStatus
                            }));
                        }
                        
                        return true;
                    } else {
                        showToast('error', 'Claim Failed', response.message);
                        return false;
                    }
                } catch (error) {
                    showToast('error', 'Claim Error', 'Failed to claim bonus');
                    return false;
                } finally {
                    setIsLoading(false);
                }
            };

            const renderPage = () => {
                if (isLoading) {
                    return (
                        <div className="loading">
                            <div className="spinner"></div>
                            <p>Loading...</p>
                        </div>
                    );
                }

                switch(currentPage) {
                    case 'dashboard':
                        return <Dashboard user={user} />;
                    case 'submit-work':
                        return <SubmitWork onSubmit={handleSubmitWork} />;
                    case 'my-submissions':
                        return <MySubmissions submissions={submissions} />;
                    case 'ar-tracking':
                        return <ARTracking user={user} history={arHistory} />;
                    case 'chat':
                        return <Chat messages={chatMessages} user={user} />;
                    case 'bonus':
                        return <Bonus onClaim={handleClaimBonus} />;
                    case 'cashout':
                        return <Cashout user={user} showToast={showToast} setCurrentUser={setCurrentUser} />;
                    case 'admin':
                        return <AdminPanel user={user} showToast={showToast} />;
                    default:
                        return <Dashboard user={user} />;
                }
            };

            return (
                <div className="main-content">
                    <div className="header">
                        <div>
                            <h1 style={{ fontSize: '1.8rem', marginBottom: '4px' }}>
                                {getPageTitle(currentPage)}
                            </h1>
                            <p style={{ color: 'var(--text-muted)' }}>
                                {getPageSubtitle(currentPage)}
                            </p>
                        </div>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                            <div style={{ 
                                background: 'var(--bg-secondary)', 
                                padding: '10px 16px', 
                                borderRadius: '8px',
                                border: '1px solid var(--border)'
                            }}>
                                <div style={{ fontSize: '0.9rem', color: 'var(--text-muted)' }}>Balance</div>
                                <div style={{ fontWeight: '700', fontSize: '1.2rem' }}>
                                    {user.balance} points
                                </div>
                            </div>
                            <div style={{ 
                                background: 'var(--bg-secondary)', 
                                padding: '10px 16px', 
                                borderRadius: '8px',
                                border: '1px solid var(--border)'
                            }}>
                                <div style={{ fontSize: '0.9rem', color: 'var(--text-muted)' }}>AR</div>
                                <div style={{ fontWeight: '700', fontSize: '1.2rem', color: 'var(--info)' }}>
                                    {user.ar.toFixed(2)}%
                                </div>
                            </div>
                        </div>
                    </div>
                    {renderPage()}
                </div>
            );
        }

        // Dashboard Component
        function Dashboard({ user }) {
            const stats = [
                { 
                    label: 'Total Points', 
                    value: user.balance, 
                    icon: 'fas fa-coins', 
                    color: 'balance' 
                },
                { 
                    label: 'Approval Rate', 
                    value: `${user.ar.toFixed(2)}%`, 
                    icon: 'fas fa-chart-line', 
                    color: 'ar' 
                },
                { 
                    label: 'USD Balance', 
                    value: `$${(user.usdBalance || 0).toFixed(2)}`, 
                    icon: 'fas fa-dollar-sign', 
                    color: 'points' 
                },
                { 
                    label: 'User Status', 
                    value: user.userStatus, 
                    icon: 'fas fa-award', 
                    color: 'status' 
                }
            ];

            return (
                <>
                    <div className="stats-grid">
                        {stats.map((stat, index) => (
                            <div key={index} className="stat-card">
                                <div className={`stat-icon ${stat.color}`}>
                                    <i className={stat.icon}></i>
                                </div>
                                <div className="stat-value">{stat.value}</div>
                                <div className="stat-label">{stat.label}</div>
                            </div>
                        ))}
                    </div>

                    <div className="card">
                        <div className="card-header">
                            <h3 className="card-title">
                                <i className="fas fa-chart-bar"></i>
                                AR Progress & Recovery System
                            </h3>
                        </div>
                        <div className="card-body">
                            <div className="ar-progress-container">
                                <div className="ar-progress-bar">
                                    <div 
                                        className="ar-progress-fill" 
                                        style={{ width: `${user.ar}%` }}
                                    ></div>
                                    <div 
                                        className="ar-current" 
                                        style={{ left: `${user.ar}%` }}
                                    >
                                        {user.ar.toFixed(1)}%
                                    </div>
                                </div>
                            </div>
                            
                            <div style={{ 
                                display: 'grid', 
                                gridTemplateColumns: '1fr 1fr', 
                                gap: '24px', 
                                marginTop: '30px' 
                            }}>
                                <div>
                                    <h4 style={{ marginBottom: '16px' }}>DoorDash-Style AR System</h4>
                                    <ul style={{ paddingLeft: '20px', listStyleType: 'none' }}>
                                        <li style={{ marginBottom: '8px' }}>
                                            <i className="fas fa-times" style={{ color: 'var(--danger)', marginRight: '8px' }}></i>
                                            <strong>Rejection</strong> = <span style={{ color: 'var(--danger)' }}>-2% AR</span>
                                        </li>
                                        <li style={{ marginBottom: '8px' }}>
                                            <i className="fas fa-check" style={{ color: 'var(--success)', marginRight: '8px' }}></i>
                                            <strong>Approval</strong> = <span style={{ color: 'var(--success)' }}>+0.66% AR</span>
                                        </li>
                                        <li style={{ marginBottom: '8px' }}>
                                            <i className="fas fa-sync-alt" style={{ color: 'var(--info)', marginRight: '8px' }}></i>
                                            <strong>Need 3 approvals</strong> to recover from 1 rejection
                                        </li>
                                        <li style={{ marginBottom: '8px' }}>
                                            <i className="fas fa-coins" style={{ color: 'var(--warning)', marginRight: '8px' }}></i>
                                            <strong>No points</strong> awarded until approval
                                        </li>
                                        <li>
                                            <i className="fas fa-comments" style={{ color: 'var(--primary)', marginRight: '8px' }}></i>
                                            <strong>Chat requires</strong> 500 points + 3 approved quizzes
                                        </li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 style={{ marginBottom: '16px' }}>Your Stats</h4>
                                    <div style={{ 
                                        background: 'var(--bg-secondary)', 
                                        padding: '20px', 
                                        borderRadius: '12px',
                                        border: '1px solid var(--border)'
                                    }}>
                                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px' }}>
                                            <div>
                                                <div style={{ fontSize: '0.9rem', color: 'var(--text-muted)' }}>Approved</div>
                                                <div style={{ fontSize: '1.5rem', fontWeight: '700' }}>{user.approvedSubmissions || 0}</div>
                                            </div>
                                            <div>
                                                <div style={{ fontSize: '0.9rem', color: 'var(--text-muted)' }}>Rejected</div>
                                                <div style={{ fontSize: '1.5rem', fontWeight: '700', color: 'var(--danger)' }}>{user.rejectedSubmissions || 0}</div>
                                            </div>
                                            <div>
                                                <div style={{ fontSize: '0.9rem', color: 'var(--text-muted)' }}>Pending</div>
                                                <div style={{ fontSize: '1.5rem', fontWeight: '700', color: 'var(--warning)' }}>{user.pendingSubmissions || 0}</div>
                                            </div>
                                            <div>
                                                <div style={{ fontSize: '0.9rem', color: 'var(--text-muted)' }}>Consecutive</div>
                                                <div style={{ fontSize: '1.5rem', fontWeight: '700', color: 'var(--success)' }}>{user.consecutiveApprovals || 0}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </>
            );
        }

        // Submit Work Component
        function SubmitWork({ onSubmit }) {
            const [submission, setSubmission] = React.useState('');
            const [isSubmitting, setIsSubmitting] = React.useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (submission.length < 10) {
                    alert('Submission must be at least 10 characters');
                    return;
                }

                setIsSubmitting(true);
                const success = await onSubmit(submission);
                if (success) {
                    setSubmission('');
                }
                setIsSubmitting(false);
            };

            return (
                <div className="card">
                    <div className="card-header">
                        <h3 className="card-title">
                            <i className="fas fa-plus-circle"></i>
                            Submit New Quiz
                        </h3>
                    </div>
                    <div className="card-body">
                        <p style={{ marginBottom: '20px', color: 'var(--text-secondary)' }}>
                            <strong>Remember:</strong> Points are only awarded when your submission is approved by an admin.
                            Rejected submissions receive 0 points and decrease your AR by 2%.
                        </p>
                        
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label className="form-label">Quiz Submission</label>
                                <textarea 
                                    className="form-control" 
                                    value={submission}
                                    onChange={(e) => setSubmission(e.target.value)}
                                    placeholder="Enter your quiz answers here. Minimum 10 characters." 
                                    required
                                ></textarea>
                                <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: '5px' }}>
                                    <small style={{ color: 'var(--text-muted)' }}>Minimum 10 characters</small>
                                    <small style={{ color: submission.length >= 10 ? 'var(--success)' : 'var(--danger)' }}>
                                        {submission.length} characters
                                    </small>
                                </div>
                            </div>
                            
                            <button 
                                type="submit" 
                                className="btn btn-primary btn-block"
                                disabled={isSubmitting}
                            >
                                {isSubmitting ? (
                                    <>
                                        <i className="fas fa-spinner fa-spin"></i>
                                        Submitting...
                                    </>
                                ) : (
                                    <>
                                        <i className="fas fa-paper-plane"></i>
                                        Submit for Review
                                    </>
                                )}
                            </button>
                        </form>
                    </div>
                </div>
            );
        }

        // My Submissions Component
        function MySubmissions({ submissions }) {
            if (submissions.length === 0) {
                return (
                    <div className="card">
                        <div className="card-header">
                            <h3 className="card-title">
                                <i className="fas fa-history"></i>
                                My Submissions
                            </h3>
                        </div>
                        <div className="card-body">
                            <div className="empty-state">
                                <i className="fas fa-history"></i>
                                <p>No submissions yet</p>
                                <p>Submit your first quiz to get started!</p>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="card">
                    <div className="card-header">
                        <h3 className="card-title">
                            <i className="fas fa-history"></i>
                            My Submissions
                        </h3>
                        <span className="badge badge-info">{submissions.length} total</span>
                    </div>
                    <div className="card-body">
                        <div className="table-responsive">
                            <table className="table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Submission</th>
                                        <th>Status</th>
                                        <th>Points</th>
                                        <th>AR Change</th>
                                        <th>Notes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {submissions.map((sub, index) => {
                                        const date = new Date(sub.submissionDate);
                                        const dateStr = `${date.toLocaleDateString()} ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                                        
                                        let statusBadge;
                                        if (sub.status === 'APPROVED') {
                                            statusBadge = <span className="badge badge-success">APPROVED</span>;
                                        } else if (sub.status === 'REJECTED') {
                                            statusBadge = <span className="badge badge-danger">REJECTED</span>;
                                        } else {
                                            statusBadge = <span className="badge badge-warning">UNDER REVIEW</span>;
                                        }

                                        return (
                                            <tr key={index}>
                                                <td>{dateStr}</td>
                                                <td>
                                                    {sub.submission.length > 50 
                                                        ? sub.submission.substring(0, 50) + '...' 
                                                        : sub.submission}
                                                </td>
                                                <td>{statusBadge}</td>
                                                <td>
                                                    {sub.pointsAwarded > 0 ? (
                                                        <span style={{ color: 'var(--success)', fontWeight: '600' }}>
                                                            +{sub.pointsAwarded}
                                                        </span>
                                                    ) : '0'}
                                                </td>
                                                <td>
                                                    {sub.arDifference > 0 ? (
                                                        <span style={{ color: 'var(--success)', fontWeight: '600' }}>
                                                            +{sub.arDifference.toFixed(2)}%
                                                        </span>
                                                    ) : sub.arDifference < 0 ? (
                                                        <span style={{ color: 'var(--danger)', fontWeight: '600' }}>
                                                            {sub.arDifference.toFixed(2)}%
                                                        </span>
                                                    ) : '0%'}
                                                </td>
                                                <td>{sub.reviewNotes || '-'}</td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        }

        // AR Tracking Component
        function ARTracking({ user, history }) {
            return (
                <div className="card">
                    <div className="card-header">
                        <h3 className="card-title">
                            <i className="fas fa-chart-line"></i>
                            AR History & Recovery Tracking
                        </h3>
                    </div>
                    <div className="card-body">
                        {history.length === 0 ? (
                            <div className="empty-state">
                                <i className="fas fa-chart-line"></i>
                                <p>No AR history yet</p>
                                <p>Submit and get your first quiz reviewed to see AR changes!</p>
                            </div>
                        ) : (
                            <>
                                <div className="table-responsive">
                                    <table className="table">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Previous AR</th>
                                                <th>New AR</th>
                                                <th>Change</th>
                                                <th>Reason</th>
                                                <th>Submission ID</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {history.map((record, index) => {
                                                const date = new Date(record.timestamp);
                                                const dateStr = `${date.toLocaleDateString()} ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                                                
                                                return (
                                                    <tr key={index}>
                                                        <td>{dateStr}</td>
                                                        <td>{record.previousAR.toFixed(2)}%</td>
                                                        <td>{record.newAR.toFixed(2)}%</td>
                                                        <td>
                                                            {record.arDifference > 0 ? (
                                                                <span style={{ color: 'var(--success)', fontWeight: '600' }}>
                                                                    +{record.arDifference.toFixed(2)}%
                                                                </span>
                                                            ) : (
                                                                <span style={{ color: 'var(--danger)', fontWeight: '600' }}>
                                                                    {record.arDifference.toFixed(2)}%
                                                                </span>
                                                            )}
                                                        </td>
                                                        <td>{record.reason}</td>
                                                        <td>{record.submissionId || '-'}</td>
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        }

        // Chat Component
        function Chat({ messages, user }) {
            const [newMessage, setNewMessage] = React.useState('');

            // For demo purposes - in real app, this would fetch from API
            const handleSendMessage = () => {
                if (!newMessage.trim()) return;
                // This would call an API in a real app
                setNewMessage('');
            };

            return (
                <div className="card">
                    <div className="card-header">
                        <h3 className="card-title">
                            <i className="fas fa-comments"></i>
                            Live Chat
                        </h3>
                        <span className="badge badge-info">{messages.length} messages</span>
                    </div>
                    <div className="card-body">
                        <div style={{ 
                            height: '400px', 
                            overflowY: 'auto', 
                            marginBottom: '20px',
                            padding: '20px',
                            background: 'var(--bg-primary)',
                            borderRadius: '8px',
                            border: '1px solid var(--border)'
                        }}>
                            {messages.length === 0 ? (
                                <div className="empty-state" style={{ padding: '40px 20px' }}>
                                    <i className="fas fa-comments"></i>
                                    <p>No messages yet</p>
                                    <p>Be the first to chat!</p>
                                </div>
                            ) : (
                                messages.map((msg, index) => (
                                    <div 
                                        key={index}
                                        style={{ 
                                            marginBottom: '16px',
                                            maxWidth: '70%',
                                            marginLeft: msg.username === user.username ? 'auto' : '0'
                                        }}
                                    >
                                        <div style={{ 
                                            display: 'flex', 
                                            justifyContent: 'space-between',
                                            marginBottom: '4px',
                                            fontSize: '0.85rem'
                                        }}>
                                            <span style={{ fontWeight: '600', color: 'var(--primary)' }}>
                                                {msg.username}
                                            </span>
                                            <span style={{ color: 'var(--text-muted)' }}>
                                                {new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                                            </span>
                                        </div>
                                        <div style={{ 
                                            background: msg.username === user.username ? 'var(--primary)' : 'var(--bg-secondary)',
                                            color: msg.username === user.username ? 'white' : 'var(--text-primary)',
                                            padding: '12px 16px',
                                            borderRadius: '12px',
                                            borderBottomRightRadius: msg.username === user.username ? '4px' : '12px',
                                            borderBottomLeftRadius: msg.username === user.username ? '12px' : '4px'
                                        }}>
                                            {msg.message}
                                        </div>
                                    </div>
                                ))
                            )}
                        </div>
                        
                        <div style={{ display: 'flex', gap: '10px' }}>
                            <input
                                type="text"
                                className="form-control"
                                value={newMessage}
                                onChange={(e) => setNewMessage(e.target.value)}
                                placeholder="Type your message here..."
                                onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                            />
                            <button 
                                className="btn btn-primary"
                                onClick={handleSendMessage}
                                disabled={!newMessage.trim()}
                            >
                                <i className="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Bonus Component
        function Bonus({ onClaim }) {
            const [bonusCode, setBonusCode] = React.useState('');
            const [isClaiming, setIsClaiming] = React.useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!bonusCode.trim()) return;

                setIsClaiming(true);
                const success = await onClaim(bonusCode);
                if (success) {
                    setBonusCode('');
                }
                setIsClaiming(false);
            };

            return (
                <div className="card">
                    <div className="card-header">
                        <h3 className="card-title">
                            <i className="fas fa-gift"></i>
                            Bonus Codes
                        </h3>
                    </div>
                    <div className="card-body">
                        <div style={{ marginBottom: '30px' }}>
                            <h4 style={{ marginBottom: '16px' }}>Claim Bonus Code</h4>
                            <form onSubmit={handleSubmit} style={{ display: 'flex', gap: '10px' }}>
                                <input 
                                    type="text" 
                                    className="form-control" 
                                    value={bonusCode}
                                    onChange={(e) => setBonusCode(e.target.value)}
                                    placeholder="Enter bonus code" 
                                    required
                                />
                                <button 
                                    type="submit" 
                                    className="btn btn-success"
                                    disabled={isClaiming}
                                >
                                    {isClaiming ? (
                                        <>
                                            <i className="fas fa-spinner fa-spin"></i>
                                            Claiming...
                                        </>
                                    ) : (
                                        <>
                                            <i className="fas fa-gift"></i>
                                            Claim
                                        </>
                                    )}
                                </button>
                            </form>
                        </div>
                        
                        <div>
                            <h4 style={{ marginBottom: '16px' }}>Available Bonus Codes</h4>
                            <div style={{ 
                                background: 'var(--bg-secondary)', 
                                padding: '20px', 
                                borderRadius: '12px',
                                border: '1px solid var(--border)'
                            }}>
                                <p style={{ color: 'var(--text-muted)', marginBottom: '12px' }}>
                                    Try these example codes (if configured in your backend):
                                </p>
                                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '10px' }}>
                                    <span style={{ 
                                        background: 'var(--bg-primary)', 
                                        padding: '8px 16px', 
                                        borderRadius: '6px',
                                        border: '1px solid var(--border)'
                                    }}>WELCOME100</span>
                                    <span style={{ 
                                        background: 'var(--bg-primary)', 
                                        padding: '8px 16px', 
                                        borderRadius: '6px',
                                        border: '1px solid var(--border)'
                                    }}>FIRSTQUIZ</span>
                                    <span style={{ 
                                        background: 'var(--bg-primary)', 
                                        padding: '8px 16px', 
                                        borderRadius: '6px',
                                        border: '1px solid var(--border)'
                                    }}>ARBOOST</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Cashout Component
        function Cashout({ user, showToast, setCurrentUser }) {
            const [amount, setAmount] = React.useState('');
            const [rewardType, setRewardType] = React.useState('PayPal');
            const [isProcessing, setIsProcessing] = React.useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                const cashoutAmount = parseFloat(amount);
                
                if (!cashoutAmount || cashoutAmount <= 0) {
                    showToast('error', 'Invalid Amount', 'Please enter a valid amount');
                    return;
                }

                if (cashoutAmount > (user.usdBalance || 0)) {
                    showToast('error', 'Insufficient Balance', 'You do not have enough USD balance');
                    return;
                }

                setIsProcessing(true);
                try {
                    const response = await callApi('submitCashout', {
                        username: user.username,
                        reward: rewardType,
                        workRateRequired: 10, // Example value
                        amount: cashoutAmount,
                        paymentDetails: `${rewardType} cashout request`
                    });

                    if (response.status === 'success') {
                        showToast('success', 'Cashout Requested', 'Your cashout request has been submitted!');
                        setAmount('');
                        
                        if (response.user) {
                            setCurrentUser(prev => ({
                                ...prev,
                                usdBalance: response.user.usdBalance
                            }));
                        }
                    } else {
                        showToast('error', 'Cashout Failed', response.message);
                    }
                } catch (error) {
                    showToast('error', 'Cashout Error', 'Failed to submit cashout request');
                } finally {
                    setIsProcessing(false);
                }
            };

            return (
                <div className="card">
                    <div className="card-header">
                        <h3 className="card-title">
                            <i className="fas fa-wallet"></i>
                            Cash Out
                        </h3>
                    </div>
                    <div className="card-body">
                        <div style={{ 
                            display: 'grid', 
                            gridTemplateColumns: '1fr 1fr', 
                            gap: '30px', 
                            marginBottom: '30px' 
                        }}>
                            <div>
                                <h4 style={{ marginBottom: '16px' }}>Your Balance</h4>
                                <div style={{ 
                                    background: 'var(--bg-secondary)', 
                                    padding: '30px', 
                                    borderRadius: '12px', 
                                    textAlign: 'center',
                                    border: '1px solid var(--border)'
                                }}>
                                    <div style={{ fontSize: '1rem', color: 'var(--text-muted)' }}>Available USD</div>
                                    <div style={{ fontSize: '2.5rem', fontWeight: '700', color: 'var(--success)', margin: '10px 0' }}>
                                        ${(user.usdBalance || 0).toFixed(2)}
                                    </div>
                                    <div style={{ fontSize: '0.9rem', color: 'var(--text-muted)' }}>
                                        {user.balance} points = ${((user.balance || 0) * 0.0006).toFixed(2)}
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 style={{ marginBottom: '16px' }}>Request Cashout</h4>
                                <form onSubmit={handleSubmit}>
                                    <div className="form-group">
                                        <label className="form-label">Reward Type</label>
                                        <select 
                                            className="form-control"
                                            value={rewardType}
                                            onChange={(e) => setRewardType(e.target.value)}
                                            required
                                        >
                                            <option value="PayPal">PayPal</option>
                                            <option value="Amazon Gift Card">Amazon Gift Card</option>
                                            <option value="Google Play">Google Play Gift Card</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    
                                    <div className="form-group">
                                        <label className="form-label">Amount (USD)</label>
                                        <input 
                                            type="number" 
                                            className="form-control" 
                                            value={amount}
                                            onChange={(e) => setAmount(e.target.value)}
                                            min="0.01" 
                                            max="100" 
                                            step="0.01" 
                                            placeholder="0.00"
                                            required
                                        />
                                        <small style={{ color: 'var(--text-muted)', display: 'block', marginTop: '4px' }}>
                                            Minimum: $0.01, Maximum: $100.00
                                        </small>
                                    </div>
                                    
                                    <button 
                                        type="submit" 
                                        className="btn btn-primary btn-block"
                                        disabled={isProcessing}
                                    >
                                        {isProcessing ? (
                                            <>
                                                <i className="fas fa-spinner fa-spin"></i>
                                                Processing...
                                            </>
                                        ) : (
                                            <>
                                                <i className="fas fa-paper-plane"></i>
                                                Submit Cashout Request
                                            </>
                                        )}
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Admin Panel Component
        function AdminPanel({ user, showToast }) {
            const [adminStats, setAdminStats] = React.useState(null);

            React.useEffect(() => {
                if (user.username.toLowerCase() === 'admin') {
                    loadAdminStats();
                }
            }, [user]);

            const loadAdminStats = async () => {
                try {
                    const response = await callApi('adminGetStats', {
                        adminUsername: 'admin',
                        adminPassword: 'admin123'
                    });

                    if (response.status === 'success') {
                        setAdminStats(response.stats);
                    }
                } catch (error) {
                    console.error('Failed to load admin stats:', error);
                }
            };

            if (user.username.toLowerCase() !== 'admin') {
                return (
                    <div className="card">
                        <div className="card-body">
                            <div className="empty-state">
                                <i className="fas fa-user-shield"></i>
                                <p>Admin Access Required</p>
                                <p>You must be logged in as admin to access this panel.</p>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="card">
                    <div className="card-header">
                        <h3 className="card-title">
                            <i className="fas fa-user-shield"></i>
                            Admin Panel
                        </h3>
                        <span className="badge badge-success">ADMIN MODE</span>
                    </div>
                    <div className="card-body">
                        <div style={{ marginBottom: '30px' }}>
                            <h4 style={{ marginBottom: '16px' }}>System Statistics</h4>
                            {adminStats ? (
                                <div style={{ 
                                    display: 'grid', 
                                    gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))', 
                                    gap: '20px' 
                                }}>
                                    <div style={{ 
                                        background: 'var(--bg-secondary)', 
                                        padding: '20px', 
                                        borderRadius: '12px',
                                        border: '1px solid var(--border)'
                                    }}>
                                        <div style={{ fontSize: '0.9rem', color: 'var(--text-muted)' }}>Total Users</div>
                                        <div style={{ fontSize: '1.8rem', fontWeight: '700' }}>{adminStats.totalUsers || 0}</div>
                                    </div>
                                    <div style={{ 
                                        background: 'var(--bg-secondary)', 
                                        padding: '20px', 
                                        borderRadius: '12px',
                                        border: '1px solid var(--border)'
                                    }}>
                                        <div style={{ fontSize: '0.9rem', color: 'var(--text-muted)' }}>Active Today</div>
                                        <div style={{ fontSize: '1.8rem', fontWeight: '700' }}>{adminStats.activeToday || 0}</div>
                                    </div>
                                    <div style={{ 
                                        background: 'var(--bg-secondary)', 
                                        padding: '20px', 
                                        borderRadius: '12px',
                                        border: '1px solid var(--border)'
                                    }}>
                                        <div style={{ fontSize: '0.9rem', color: 'var(--text-muted)' }}>Total Submissions</div>
                                        <div style={{ fontSize: '1.8rem', fontWeight: '700' }}>{adminStats.totalSubmissions || 0}</div>
                                    </div>
                                    <div style={{ 
                                        background: 'var(--bg-secondary)', 
                                        padding: '20px', 
                                        borderRadius: '12px',
                                        border: '1px solid var(--border)'
                                    }}>
                                        <div style={{ fontSize: '0.9rem', color: 'var(--text-muted)' }}>Submissions Today</div>
                                        <div style={{ fontSize: '1.8rem', fontWeight: '700' }}>{adminStats.submissionsToday || 0}</div>
                                    </div>
                                </div>
                            ) : (
                                <div className="loading">
                                    <div className="spinner"></div>
                                    <p>Loading admin statistics...</p>
                                </div>
                            )}
                        </div>

                        <div>
                            <h4 style={{ marginBottom: '16px' }}>Admin Actions</h4>
                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '12px' }}>
                                <button 
                                    className="btn btn-primary"
                                    onClick={() => showToast('info', 'Admin Action', 'This would open submission review')}
                                >
                                    <i className="fas fa-check-circle"></i> Review Submissions
                                </button>
                                <button 
                                    className="btn btn-warning"
                                    onClick={() => showToast('info', 'Admin Action', 'This would open user management')}
                                >
                                    <i className="fas fa-users"></i> Manage Users
                                </button>
                                <button 
                                    className="btn btn-success"
                                    onClick={() => showToast('info', 'Admin Action', 'This would process cashouts')}
                                >
                                    <i className="fas fa-wallet"></i> Process Cashouts
                                </button>
                                <button 
                                    className="btn btn-danger"
                                    onClick={() => showToast('info', 'Admin Action', 'This would open system configuration')}
                                >
                                    <i className="fas fa-cog"></i> System Config
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Helper functions
        function getPageTitle(page) {
            const titles = {
                'dashboard': 'Dashboard',
                'submit-work': 'Submit Quiz',
                'my-submissions': 'My Submissions',
                'ar-tracking': 'AR Tracking',
                'chat': 'Live Chat',
                'bonus': 'Bonus Codes',
                'cashout': 'Cash Out',
                'admin': 'Admin Panel'
            };
            return titles[page] || 'Dashboard';
        }

        function getPageSubtitle(page) {
            const subtitles = {
                'dashboard': 'Welcome to your DoorDash-style earning dashboard',
                'submit-work': 'Submit quizzes for review and earn points',
                'my-submissions': 'Track your submission history and status',
                'ar-tracking': 'Monitor your Approval Rate and recovery progress',
                'chat': 'Chat with other qualified users',
                'bonus': 'Claim bonus codes for extra points',
                'cashout': 'Convert your points to real rewards',
                'admin': 'Administration and moderation tools'
            };
            return subtitles[page] || '';
        }

        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
